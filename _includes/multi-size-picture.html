{%- assign sizes_list = include.sizes | split: ',' %}
{%- for size in sizes_list %}
  {%- capture tmp %}@{{ size }}.{% endcapture -%}
  {% if include.image contains tmp %}
    {% assign size_tag = tmp %}
  {% endif %}
{% endfor %}
{%- if size_tag -%}
<picture>
  {%- if include.webp %}
    <source
      srcset="{% for size in sizes_list -%}
        {%- capture new_tag %}@{{ size }}.{% endcapture -%}
        {{ site.baseurl }}{{ include.image | replace: size_tag, new_tag }}.webp {{ size }}{% if forloop.last == false %},{% endif %}
      {% endfor %}"
      type="image/webp"
    />
  {%- endif %}
  <source
    srcset="{% for size in sizes_list -%}
      {%- capture new_tag %}@{{ size }}.{% endcapture -%}
      {{ site.baseurl }}{{ include.image | replace: size_tag, new_tag }} {{ size }}{% if forloop.last == false %},{% endif %}
    {% endfor %}"
  />
  <img class="{{ include.class }}" src="{{ site.baseurl }}{{ include.image }}" alt="{{ include.alt }}" />
</picture>
{%- else -%}
  <strong style="color: red">No image size tag detected!</strong>
{%- endif -%}
